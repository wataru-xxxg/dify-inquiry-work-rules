# 就業規則チャットフロー

就業規則に関する質問に、ナレッジベースを参照して回答する Dify のアドバンスドチャットフローです。

## 概要

- **アプリ名**: 就業規則チャットフロー
- **モード**: advanced-chat（アドバンスドチャット）
- **バージョン**: 0.5.0

## フロー構成

```
開始 → 知識取得 → LLM → HTTP リクエスト → 回答
```

| ノード | 説明 |
|--------|------|
| **開始** | ユーザー入力の起点 |
| **知識取得** | ナレッジベースから関連ドキュメントを検索（RAG） |
| **LLM** | 検索結果を参照して回答を生成（Gemini 2.5 Flash） |
| **HTTP リクエスト** | 質問・回答を外部（Google Apps Script）へ送信 |
| **回答** | ユーザーへの最終応答 |

## 主な仕様

### 知識取得（RAG）

- **取得モード**: multiple（複数ドキュメント）
- **トップK**: 4
- **リランキング**: 無効
- **ベクトル重み**: 1（ベクトル検索のみ）
- ナレッジベースのデータセット ID は YAML 内で指定されています。

### LLM

- **モデル**: `gemini-2.5-flash`（langgenius/gemini）
- **温度**: 0.7
- **システムプロンプト**:  
  ナレッジの `{{#context#}}` を参照して回答し、記載がない・正確に答えられない場合は  
  **「担当者へ直接ご確認ください」** と返すよう指示されています。

### HTTP リクエスト

- **メソッド**: POST
- **URL**: Google Apps Script の Web アプリ URL（ログ・フィードバック用と想定）
- **ボディ**: `{ question: ユーザー質問, answer: LLM の回答 }`
- **リトライ**: 有効（最大 3 回、間隔 100ms）

## 依存関係

- **マーケットプレイスプラグイン**: `langgenius/gemini:0.7.8`

## ファイル

| ファイル | 説明 |
|----------|------|
| `就業規則チャットフロー.yml` | Dify のワークフロー定義（インポート用） |

## 利用手順（Dify での利用）

1. Dify にログインし、該当ワークスペースを開く。
2. **スタジオ** で **ワークフロー** を選択。
3. メニューから **インポート** を選び、`就業規則チャットフロー.yml` を指定してインポート。
4. ナレッジベースのデータセットを用意し、ワークフロー内の「知識取得」ノードで同じデータセットを参照するように設定（必要に応じてデータセット ID を差し替え）。
5. Google Apps Script の URL を使う場合は、HTTP リクエストノードの URL を環境に合わせて変更。
6. デプロイしてチャットアプリとして公開。

## 注意事項

- ナレッジベースに就業規則の原文・Q&A を登録しておく必要があります。
- HTTP リクエスト先の Google Apps Script は、受け取った質問・回答の保存・利用方法をあらかじめ実装してください。
- 機密情報が含まれる場合は、送信先 URL と Dify の設定の取り扱いに注意してください。
